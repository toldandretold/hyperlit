[
    {
        "chunk_id": 0,
        "start_line": 1,
        "end_line": 77,
        "blocks": [
            {
                "type": "paragraph",
                "startLine": 1,
                "content": "IndexedDB Structure"
            },
            {
                "type": "heading",
                "level": 2,
                "startLine": 3,
                "content": "macro units"
            },
            {
                "type": "paragraph",
                "startLine": 5,
                "content": "1. DOM - can be saved to indexedDB per <div data-chunk-id=\"\">, after visible data-chunk-id is updated."
            },
            {
                "type": "paragraph",
                "startLine": 7,
                "content": "This is done so that, if user returns to browser and DOM has not been cached, dont' need to re-initialize lazy loading, or load from nodeChunks, can just insert the last visible data-chunk-id as pre-rendered html, and then begin listening for sentinels etc."
            },
            {
                "type": "paragraph",
                "startLine": 9,
                "content": "2. IndexedDB parses nodeChunks.json into structured data storage so that IndexedDB can be updated on a line-by-line basis on front end. This means that front end creates the time-stamp, and sends this to back-end. And this means that page-refreshing should be minimal and users can work offline.\u00a0"
            },
            {
                "type": "paragraph",
                "startLine": 11,
                "content": "nodeChunks.json is initially created by parseing main-text.md into chunks, nodes, line-numbers, md-content, hyperlights, and hypercites."
            },
            {
                "type": "paragraph",
                "startLine": 13,
                "content": "The hyperlights and hypercites store the hyperlight_ids and hypercite_ids of the md content."
            },
            {
                "type": "paragraph",
                "startLine": 15,
                "content": "These ideas refer to, or are links other indexedDB databases: hyperlights and hyperictes."
            },
            {
                "type": "paragraph",
                "startLine": 17,
                "content": "There, each hyperlight and hypercite has the start-line-number, end-line-number, character-count start, and character-count end."
            },
            {
                "type": "heading",
                "level": 1,
                "startLine": 19,
                "content": "updating IndexedDB"
            },
            {
                "type": "heading",
                "level": 2,
                "startLine": 21,
                "content": "macro workflow of front-end to back-end"
            },
            {
                "type": "paragraph",
                "startLine": 23,
                "content": "If the indexedDB is intialised correctly, any highlight or hypercite that is added or removed can trigger an update of the IndexedDB, on the front end."
            },
            {
                "type": "paragraph",
                "startLine": 25,
                "content": "When a certain time has elapsed after the indexedDB has been updated, the changs will be batched and sent to back-end, along with a time-stamp, from the front end."
            },
            {
                "type": "paragraph",
                "startLine": 27,
                "content": "Thus, the back-end is mostly used for saving the .json files, according to the front end. The **advantage of this** is that, on page load, the timestamps should rarely not match, and so the user should only need a hard re-load when moving to a diff browser, or when they have edited their md files locally on a plain text editor like obsidian."
            },
            {
                "type": "heading",
                "level": 2,
                "startLine": 29,
                "content": "micro workflow on front-end"
            },
            {
                "type": "heading",
                "level": 3,
                "startLine": 31,
                "content": "Adjusting line-number on update"
            },
            {
                "type": "paragraph",
                "startLine": 33,
                "content": "IndexedDB needs to be initialised such that the line-number value of each md-content (stored by line), is automatically updated when a new line\/html-node is inserted or deleted."
            },
            {
                "type": "paragraph",
                "startLine": 35,
                "content": "This can happen because all html nodes in the Dom receive an id that matches the md line number initially given in nodeChunks.json, and stored in the IndexedDB structure."
            },
            {
                "type": "paragraph",
                "startLine": 37,
                "content": "So, say user inserts a new html paragraph between html-nodes 17 and 18, that needs to insert in the indexedDB database between these entries, and re-number by one all those following it."
            },
            {
                "type": "paragraph",
                "startLine": 39,
                "content": "If one is deleted, all those following need to have that number reduced by one."
            },
            {
                "type": "heading",
                "level": 3,
                "startLine": 42,
                "content": "adjusting character counts on update"
            },
            {
                "type": "paragraph",
                "startLine": 44,
                "content": "A similar function needs to take place when content is changed within a line. This is for hyperlights and hypercites. So, lets say that we have a hyperlight with start-value of (5, 3). This represents line 5 and character 3. and an end-value of (6, 5), which represents line 6 and character 5."
            },
            {
                "type": "paragraph",
                "startLine": 46,
                "content": "If user deletes characters before the highlight, say character (5,1), then the start-value of the highlight needs to be reduced to (5,2). if characters within the highlight are changed, then the end-value may need to be changed."
            },
            {
                "type": "paragraph",
                "startLine": 50,
                "content": "exmaple of structure:"
            },
            {
                "type": "paragraph",
                "startLine": 52,
                "content": "{"
            },
            {
                "type": "paragraph",
                "startLine": 53,
                "content": "url: \"https:\/\/example.com\","
            },
            {
                "type": "paragraph",
                "startLine": 54,
                "content": "container: \"main\","
            },
            {
                "type": "paragraph",
                "startLine": 55,
                "content": "book: \"book1\","
            },
            {
                "type": "paragraph",
                "startLine": 56,
                "content": "lineNumber: 50,  \/\/ This indicates the start line for this record"
            },
            {
                "type": "paragraph",
                "startLine": 57,
                "content": "chunk_id: 1,"
            },
            {
                "type": "paragraph",
                "startLine": 58,
                "content": "blocks: ["
            },
            {
                "type": "paragraph",
                "startLine": 59,
                "content": "{"
            },
            {
                "type": "paragraph",
                "startLine": 60,
                "content": "type: \"paragraph\","
            },
            {
                "type": "paragraph",
                "startLine": 61,
                "content": "content: \"Some markdown content for this line\","
            },
            {
                "type": "paragraph",
                "startLine": 62,
                "content": "startLine: 50,"
            },
            {
                "type": "paragraph",
                "startLine": 63,
                "content": "}"
            },
            {
                "type": "paragraph",
                "startLine": 64,
                "content": "],"
            },
            {
                "type": "paragraph",
                "startLine": 65,
                "content": "hyperlights: ["
            },
            {
                "type": "paragraph",
                "startLine": 66,
                "content": "{"
            },
            {
                "type": "paragraph",
                "startLine": 67,
                "content": "hyperlight_id: \"hl-1234\","
            },
            {
                "type": "paragraph",
                "startLine": 68,
                "content": "Start: yes\/no,"
            },
            {
                "type": "paragraph",
                "startLine": 69,
                "content": "Middle: yes\/no,"
            },
            {
                "type": "paragraph",
                "startLine": 70,
                "content": "End: yes\/no"
            },
            {
                "type": "paragraph",
                "startLine": 71,
                "content": "}"
            },
            {
                "type": "paragraph",
                "startLine": 72,
                "content": "],"
            },
            {
                "type": "paragraph",
                "startLine": 73,
                "content": "hypercites: ["
            },
            {
                "type": "paragraph",
                "startLine": 74,
                "content": "{"
            },
            {
                "type": "paragraph",
                "startLine": 75,
                "content": "hyperlight_id: \"hl-1234\","
            },
            {
                "type": "paragraph",
                "startLine": 76,
                "content": "Start: yes\/no,"
            },
            {
                "type": "paragraph",
                "startLine": 77,
                "content": "Middle: yes\/no,"
            }
        ]
    },
    {
        "chunk_id": 1,
        "start_line": 78,
        "end_line": 90,
        "blocks": [
            {
                "type": "paragraph",
                "startLine": 78,
                "content": "End: yes\/no"
            },
            {
                "type": "paragraph",
                "startLine": 79,
                "content": "}"
            },
            {
                "type": "paragraph",
                "startLine": 80,
                "content": "],"
            },
            {
                "type": "paragraph",
                "startLine": 81,
                "content": "footnotes: ["
            },
            {
                "type": "paragraph",
                "startLine": 82,
                "content": "{"
            },
            {
                "type": "paragraph",
                "startLine": 83,
                "content": "md: \"[^66]\","
            },
            {
                "type": "paragraph",
                "startLine": 84,
                "content": "content: \"The content to be displayed.\""
            },
            {
                "type": "paragraph",
                "startLine": 85,
                "content": "}"
            },
            {
                "type": "paragraph",
                "startLine": 86,
                "content": "]"
            },
            {
                "type": "paragraph",
                "startLine": 87,
                "content": "}"
            }
        ]
    }
]